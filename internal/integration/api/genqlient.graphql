fragment Job on Job {
    ... on JobTypeCommand {
        ...CommandJob
    }
}

fragment CommandJob on JobTypeCommand {
    uuid
}

fragment Build on Build {
    uuid
    id
    number
    state
    jobs(first: 100) {
        edges {
            # @genqlient(flatten: true)
            node {
                ...Job
            }
        }
    }
}

mutation BuildCreate($input: BuildCreateInput!) {
    buildCreate(input: $input) {
        build {
            ...Build
        }
    }
}

mutation BuildCancel($input: BuildCancelInput!) {
    buildCancel(input: $input) {
        clientMutationId
    }
}

query GetBuild($uuid: ID!) {
    build(uuid: $uuid) {
        ...Build
    }
}

query GetBuilds($slug: ID!, $state: [BuildStates!], $first: Int) {
    pipeline(slug: $slug) {
        builds(state: $state, first: $first) {
            edges {
                node {
                    ...Build
                }
            }
        }
    }
}

query GetJobEvents($jobId: ID!) {
  job(uuid: $jobId) {
    ... on JobTypeCommand {
      events(last: 100) {
        edges {
          node {
            id
            type
            timestamp
            ... on JobEventStackError {
              errorDetail
            }
          }
        }
      }
    }
  }
}


### The following are used in the cleanup integration "test"
mutation PipelineDelete($input: PipelineDeleteInput!) {
    pipelineDelete(input: $input) {
        clientMutationId
    }
}

query SearchPipelines($slug: ID!, $search: String!, $first: Int!, $after: String) {
    organization(slug: $slug) {
        pipelines(search: $search, first: $first, after: $after) {
            edges {
                node {
                    id
                    name
                }
            }
            pageInfo {
                hasNextPage
                endCursor
            }
        }
    }
}

### The following are used in the cleanup integration "test" for queues
query GetOrganizationQueues($slug: ID!, $clustersFirst: Int!, $clustersAfter: String, $queuesFirst: Int!) {
    organization(slug: $slug) {
        id
        clusters(first: $clustersFirst, after: $clustersAfter) {
            edges {
                node {
                    id
                    uuid
                    name
                    queues(first: $queuesFirst) {
                        edges {
                            node {
                                id
                                key
                                description
                            }
                        }
                        pageInfo {
                            hasNextPage
                            endCursor
                        }
                    }
                }
            }
            pageInfo {
                hasNextPage
                endCursor
            }
        }
    }
}

query GetClusterQueues($orgSlug: ID!, $clusterUUID: ID!, $first: Int!, $after: String) {
    organization(slug: $orgSlug) {
        cluster(id: $clusterUUID) {
            id
            queues(first: $first, after: $after) {
                edges {
                    node {
                        id
                        key
                        description
                    }
                }
                pageInfo {
                    hasNextPage
                    endCursor
                }
            }
        }
    }
}

mutation ClusterQueueDelete($input: ClusterQueueDeleteInput!) {
    clusterQueueDelete(input: $input) {
        deletedClusterQueueId
    }
}
